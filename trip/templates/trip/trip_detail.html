{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load account %}
{% load socialaccount %}
{% load widget_tweaks %}
{% load static tailwind_tags %}


{% block header %}
  <title>ThaiRepose::{{ name }}</title>
    <style>
        body {
            background: url("{% static '/images/bg-blur.jpg' %}") no-repeat fixed;
            background-size: cover;
        }

         p {
            max-width: 75ch;
            word-wrap: break-word;
        }
    </style>
    <link rel="stylesheet" href="{% static 'trip/css/container_blocks.css' %}" />
    <link rel="stylesheet" href="https://npmcdn.com/flickity@2/dist/flickity.css" />
{% endblock %}

{% block main_content %}
<div id="content" class="flex-grow items-center justify-center px-5 py-5 md:px-10 md:py-10 mb-20">
    <div>
        <h1>{{ post.title }} </h1>
    </div>
    <div>
        <small> By: {{ post.author }}</small>
        <p>Create at: {{ post.post_date }}</p>
        <P>durations: {{ post.duration }}</P>
        <P>price: {{ post.price }}</P>
    </div>
    <div>
        <p>{{ post.body|safe }}<p>
        <form action="{% url 'trip:list_trip' post.pk %}" method="POST">
            {% csrf_token %}
            <button type="submit" name="trip_id" value="{{ post.id }}">Like</button>
            - {{ post.total_like }}
        </form>
    </div>
    {% if user.is_authenticated %}
        {% if user.id == post.author.id %}
    <a href="{% url 'trip:editpost' post.pk%}">(Edit)</a>
    <a href="{% url 'trip:deletepost' post.pk%}">(!!!DELETE!!!)</a>
        {% endif %}
    {% endif %}
    <a href="{% url 'trip:tripplan' %}">(ALL TRIP)</a>
    <br/><br>
    <h2>Review</h2>
    <br>
    {% if not post.review.all %}
        No review Yet
        <a href="{% url 'trip:addreview' post.pk%}">---Add commend---</a>
    {% else %}
        {% for commend in post.review.all %}
        <strong>{{commend.name}} - {{commend.date_added}} </strong>
        {{commend.body}}
        <form action="{% url 'trip:list_commend' post.pk %}" method="POST">
            {% csrf_token %}
            <button type="submit" name="commend_id" value="{{ commend.id }}">Like</button>
            - {{ commend.total_like }}
        </form>
        <br>
        {% endfor %}
        <a href="{% url 'trip:addreview' post.pk%}">---Add commend---</a>
    {% endif %}
    {% if user.is_authenticated %}
        {% if user.id == post.author.id %}
            <div>
                <button id="background-delete-button" class="px-6 py-3 bg-red-600 text-gray-100 rounded shadow">
                    delete
                </button>
            </div>
        {% endif %}
    {% endif %}
</div>

<div id="overlay" class="absolute inset-0 hidden justify-center items-center" style="background-color: rgba(0,0,0,0.5);">
    <div class="bg-gray-100 px-4 py-2 rounded-lg">
        <h3 class="text-xl text-black">Confirm Delete?</h3>
        <div>
            Are you sure to delete this post.</br>Click yes to continue
        </div>
        <div class="mt-3 flex justify-end space-x-3">
            <button id="cancel-btn" class="px-3 py-1 rounded bg-gray-300 hover:bg-gray-200">Cancel</button>
            <form action="{% url 'trip:deletepost' post.pk %}" method="post">
            {% csrf_token %}
                <button class="px-3 py-1 rounded bg-red-800 text-gray-200 hover:bg-red-600" type="submit" value="Delete post">Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
    window.addEventListener
    ('DOMContentLoaded', () =>{
        const overlay = document.querySelector('#overlay')
        const delBtn = document.querySelector('#background-delete-button')
        const CancelBtn = document.querySelector('#cancel-btn')

        const toggleModal = () => {
            overlay.classList.toggle('hidden')
            overlay.classList.toggle('flex')
        }

        delBtn.addEventListener('click', toggleModal)

        CancelBtn.addEventListener('click', toggleModal)
    })
</script>

{% endblock %}