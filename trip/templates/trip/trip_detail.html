{% extends 'base.html' %}
{% block header %}
    <style>
         p {
            max-width: 75ch;
            word-wrap: break-word;
        }
    @media screen and (min-width: 600px) {
        .children form {
        margin-left: +48px;
        /* will touch very left side */
        }

        .children .children form {
        margin-left: +96px;
        /* will touch very left side */
        }
    }

    </style>
{% endblock %}

{% block main_content %}
<h1>{{ post.title }} </h1>
<small> By: {{ post.author }}</small>
<p>Create at: {{ post.post_date }}</p>
<P>durations: {{ post.duration }}</P>
<P>price: {{ post.price }}</P>
<p>{{ post.body|safe }}<p>
<form action="{% url 'trip:list_trip' post.pk %}" method="POST">
    {% csrf_token %}
    <button type="submit" name="trip_id" value="{{ post.id }}">Like</button>
    - {{ post.total_like }}
</form>
{% if user.is_authenticated %}
    {% if user.id == post.author.id %}
<a href="{% url 'trip:editpost' post.pk%}">(Edit)</a>
<a href="{% url 'trip:deletepost' post.pk%}">(!!!DELETE!!!)</a>
    {% endif %}
{% endif %}
<a href="{% url 'trip:tripplan' %}">(ALL TRIP)</a>
<br/><br>
<h2>Review</h2>
<br>
{% if not commend.all %}
    No review Yet
    {% if user.is_authenticated %}
    <h1>Add Comment</h1>
    <form method="POST">
        {% csrf_token %}
        body: {{ review_form.body }}
        <button>Add comment</button>
    </form>
    {% else %}
        <p>Login to write commend.</p>
    {% endif %}
{% else %}
    <div>
        {% load mptt_tags %}
        {% recursetree commend %}
        <div id="{{ node.id }}" class="my-2 p-2" style="border: 1px solid grey">
            <div class="flex justify-between">By {{ node.name }}<div></div>{{ node.date_added }}</div>
            <div>{{ node.body }}</div>
            <hr/>
            {% if node.level < 3 %}
            <button class="button" onclick="myFunction({{ node.id }})">Reply</button>
        {% endif %}
            </div>
            {% if not node.is_leaf_node %}
            <div class="children ml-8">
            {{ children }}
            </div>
            {% endif %}
            {% endrecursetree %}
        </div>
    
    <div class="py-4">
        <nav aria-label="Page navigation example">
            {% if comments.has_other_pages %}
            <ul class="pagination">
            {% if comments.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ comments.previous_page_number }}">Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
            {% endif %}
            {% for num in comments.paginator.page_range %}
            {% if comments.number == l %}
            <li class="page-item active"><span class="page-link">{{ num }} <span class="sr-only">(current)</span></span>
            </li>
            {% else %}
            <li><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
            {% endfor %}
            {% if comments.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ comments.next_page_number }}">Next</a></li>
            {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
            {% endif %}
            </ul>
            {% endif %}
        </nav>
    </div>

    <p>---Add commend---</p>
    {% if user.is_authenticated %}
        <div id="myDIV" style="display:block;">
        <form id="myForm" method="post">
          <h2>Create new comment</h2>
          {% csrf_token %}
          {{ review_form.parent}}
          {{ review_form.body }}
          <button type="submit">Submit</button>
        </form>
      </div>
    {% else %}
        <p>Login to wirte commend.</p>
    {% endif %}
{% endif %}

<script>
    function formExit() {
      document.getElementById("newForm").remove();
    }
  
    function myFunction(id) {
      if (document.contains(document.getElementById("newForm"))) {
        document.getElementById("newForm").remove();
      }
      
  
      var d1 = document.getElementById(id);
      d1.insertAdjacentHTML('afterend',
        '<form id="newForm" method="post"> \
            {% csrf_token %} \
            <div class="flex justify-between"><h2>Reply:</h2><div><button type="button" onclick="formExit()"">Close</button></div></div> \
            <select name="parent" class="invisible" id="id_parentt"> \
            <option value="' + id + '" selected"></option> \
            </select> \
            <textarea name="body" cols="40" rows="5" class="form-control" required id="id_body"></textarea> \
            <button type="submit">Submit</button> \
        </form>');
  
      //document.querySelector('#id_parentt [value="' + id + '"]').selected = true;
    }
  
    $('#myForm').trigger("reset");
  </script>

{% endblock %}